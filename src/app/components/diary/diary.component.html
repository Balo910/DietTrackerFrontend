<div class="diary-container">
  <h2>Dziennik żywieniowy - {{ currentDate | date:'dd.MM.yyyy' }}</h2>
  
  <div class="date-controls">
    <button (click)="changeDate(-1)">← Poprzedni</button>
    <input type="date" 
           [value]="currentDate | date:'yyyy-MM-dd'"
           (change)="setNewDate($event)" />
    <button (click)="changeDate(1)">Następny →</button>
  </div>

  @if (isLoading) {
    <div class="loading">Ładowanie...</div>
  } @else if (errorMessage) {
    <div class="error">{{ errorMessage }}</div>
  }

  <button (click)="openAddDialog('breakfast')">Add new diary entry</button>

  @let diariesWithFoods = givenDayDiary$ | async;
  @for (diaryEntry of diariesWithFoods; track diaryEntry.id) {
    <div class="entry diary-entry">
      <span>ID: {{diaryEntry.id}}</span>
      <div>Date: {{diaryEntry.date}}</div>
      @if (diaryEntry.diaryFoods?.length) {
        <div>Foods:</div>
        @for (food of diaryEntry.diaryFoods; track food.id) {
          <ul class="food-entry">
            <li>
              <span>{{ food?.foodName }} contains ({{ food.calories }} kcal)</span>
              <table>
                <tr>
                  <th>Amount</th>
                  <th>Calories</th>
                  <th>Carbs</th>
                  <th>Proteins</th>
                  <th>Fats</th>
                </tr>
                <tr *ngFor="let food of diaryEntry.diaryFoods">
                  <td>{{ food.weight }}</td>
                  <td>{{ food.calories }}</td>
                  <td>{{ food.carbs }}</td>
                  <td>{{ food.proteins }}</td>
                  <td>{{ food.fats }}</td>
                </tr>
              </table>
              <button (click)="removeFood(diaryEntry.id, food.foodId)">×</button>
            </li>
          </ul>
        }
      } 
    </div>
  }

  @for (meal of diaries; track meal.mealType) {
    <div class="meal-card">
      <div class="meal-header">
        <h3>{{ meal.mealType }}</h3>
        <button (click)="openAddDialog(meal.mealType)">+ Dodaj</button>
      </div>
      
      @if (meal.diaryFoods.length === 0 && meal.fluids.length === 0) {
        <div class="empty-meal">Brak wpisów</div>
      }

      @for (food of meal.diaryFoods; track food.id) {
        <div class="entry food-entry">
          <span>{{ food.foodName }} ({{ food.calories }} kcal)</span>
          <button (click)="removeFood(meal.id, food.foodId)">×</button>
        </div>
      }

    </div>

  }

  <button class="back-btn" routerLink="/">Powrót</button>
</div>